generator client {
  provider        = "prisma-client"
  output          = "../src/prisma"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  extensions = [citext]
}

model Board {
  id          String   @id @default(uuid()) @map("id")
  title       String   @map("title")
  seq         Int      @default(0) @map("seq")
  ownerUserId String   @map("owner_user_id")
  createdAt   DateTime @default(now()) @map("created_at")

  invites BoardInvite[]
  columns Column[]
  members BoardMember[]
  cards   Card[]

  @@index([ownerUserId], map: "idx_boards_owner_user_id")
  @@map("boarddb.boards")
}

model BoardMember {
  id        String   @id @default(uuid())
  boardId   String   @map("board_id")
  userId    String   @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")

  board Board @relation(fields: [boardId], references: [id], onDelete: Cascade)

  @@unique([boardId, userId], map: "ux_board_members_board_user")
  @@index([userId], map: "idx_board_members_user")
  @@map("boarddb.board_members")
}

enum InviteType {
  TEMPORARY
  PERMANENT

  @@map("invite_type")
}

model BoardInvite {
  boardId   String     @map("board_id")
  type      InviteType @map("type")
  token     String     @map("token") @db.VarChar(64)
  expiresAt DateTime?  @map("expires_at")
  createdAt DateTime   @default(now()) @map("created_at")

  board Board @relation(fields: [boardId], references: [id], onDelete: Cascade)

  @@id([boardId, type])
  @@unique([token], map: "ux_board_invites_token")
  @@index([expiresAt], map: "idx_board_invites_expires_at")
  @@map("boarddb.board_invites")
}

model Column {
  id       String  @id @default(uuid())
  boardId  String  @map("board_id")
  title    String
  position Decimal @db.Decimal(18, 6)

  board Board  @relation(fields: [boardId], references: [id], onDelete: Cascade)
  cards Card[]

  @@index([boardId, position], map: "idx_columns_board_id_position")
  @@map("boarddb.columns")
}

model Card {
  id        String   @id @default(uuid())
  boardId   String   @map("board_id")
  columnId  String   @map("column_id")
  position  Decimal  @db.Decimal(18, 6)
  text      String   @db.Text
  userId    String   @map("user_id")
  userLogin String   @map("user_login")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  board  Board      @relation(fields: [boardId], references: [id], onDelete: Cascade)
  column Column     @relation(fields: [columnId], references: [id], onDelete: Cascade)
  likes  CardLike[]

  @@index([boardId, columnId, position], map: "idx_cards_board_id_column_id_position")
  @@index([userId], map: "idx_cards_author_id")
  @@map("boarddb.cards")
}

model CardLike {
  id        String @id @default(uuid())
  cardId    String @map("card_id")
  userId    String @map("user_id")
  userLogin String @map("user_login")

  card Card @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@unique([cardId, userId], map: "ux_card_likes_card_user")
  @@index([userId], map: "idx_card_likes_user")
  @@map("boarddb.card_likes")
}
